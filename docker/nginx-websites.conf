events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';

    access_log /var/log/nginx/access.log main;
    error_log /var/log/nginx/error.log;

    sendfile        on;
    tcp_nopush      on;
    tcp_nodelay     on;
    keepalive_timeout 65;
    types_hash_max_size 2048;

    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;

    # Upstream servers
    upstream usmanramzan_ai {
        server websites-server:8001;
    }

    upstream urnlabs_ai {
        server websites-server:8002;
    }

    upstream eprecisio_com {
        server websites-server:8003;
    }

    # Main website routing
    server {
        listen 80;
        server_name localhost;

        # Default route - show website selection
        location = / {
            return 200 '
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urnlabs Platform - Website Selection</title>
    <style>
        body { 
            font-family: Inter, -apple-system, BlinkMacSystemFont, sans-serif; 
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            color: #e2e8f0; 
            margin: 0; 
            padding: 40px 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container { max-width: 1200px; margin: 0 auto; text-align: center; }
        h1 { 
            font-size: 3rem; 
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 50%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle { font-size: 1.25rem; color: #94a3b8; margin-bottom: 3rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem; margin-top: 2rem; }
        .card { 
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem; 
            padding: 2rem; 
            text-decoration: none; 
            color: inherit; 
            transition: all 0.3s ease;
        }
        .card:hover { 
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(6, 182, 212, 0.5);
            box-shadow: 0 20px 25px -5px rgba(6, 182, 212, 0.2);
        }
        .card-icon { font-size: 3rem; margin-bottom: 1rem; }
        .card-title { font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem; }
        .card-desc { color: #94a3b8; margin-bottom: 1.5rem; }
        .card-url { 
            background: rgba(6, 182, 212, 0.1); 
            border: 1px solid rgba(6, 182, 212, 0.3);
            padding: 0.5rem 1rem; 
            border-radius: 0.5rem; 
            font-family: monospace; 
            font-size: 0.875rem;
            color: #06b6d4;
        }
        .status { display: inline-block; width: 8px; height: 8px; background: #10b981; border-radius: 50%; margin-right: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸš€ Urnlabs Platform</h1>
        <p class="subtitle">Choose a website to explore</p>
        
        <div class="grid">
            <a href="/usmanramzan/" class="card">
                <div class="card-icon">ðŸ§ </div>
                <h3 class="card-title">Usman Ramzan AI</h3>
                <p class="card-desc">Personal AI portfolio with neural network visualizations and interactive capabilities</p>
                <div class="card-url"><span class="status"></span>localhost:8000/usmanramzan/</div>
            </a>
            
            <a href="/urnlabs/" class="card">
                <div class="card-icon">ðŸ¤–</div>
                <h3 class="card-title">UrnLabs AI Platform</h3>
                <p class="card-desc">Production-ready AI agent platform with governance-first approach</p>
                <div class="card-url"><span class="status"></span>localhost:8000/urnlabs/</div>
            </a>
            
            <a href="/eprecisio/" class="card">
                <div class="card-icon">âš¡</div>
                <h3 class="card-title">EPrecisio DevOps</h3>
                <p class="card-desc">World-class DevOps consulting with infrastructure visualizations</p>
                <div class="card-url"><span class="status"></span>localhost:8000/eprecisio/</div>
            </a>
        </div>
        
        <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1); color: #64748b; font-size: 0.875rem;">
            <p>Sister companies powering AI-enhanced DevOps excellence</p>
            <p>Direct access: <code style="background: rgba(255,255,255,0.1); padding: 0.25rem 0.5rem; border-radius: 0.25rem;">usmanramzan.ai:8001</code> | <code style="background: rgba(255,255,255,0.1); padding: 0.25rem 0.5rem; border-radius: 0.25rem;">urnlabs.ai:8002</code> | <code style="background: rgba(255,255,255,0.1); padding: 0.25rem 0.5rem; border-radius: 0.25rem;">eprecisio.com:8003</code></p>
        </div>
    </div>
</body>
</html>';
            add_header Content-Type text/html;
        }

        # Usmanramzan AI
        location /usmanramzan/ {
            rewrite ^/usmanramzan/(.*)$ /$1 break;
            proxy_pass http://usmanramzan_ai;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # UrnLabs AI
        location /urnlabs/ {
            rewrite ^/urnlabs/(.*)$ /$1 break;
            proxy_pass http://urnlabs_ai;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # EPrecisio
        location /eprecisio/ {
            rewrite ^/eprecisio/(.*)$ /$1 break;
            proxy_pass http://eprecisio_com;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Health check endpoints
        location /health {
            return 200 '{"status": "healthy", "services": {"usmanramzan-ai": "running", "urnlabs-ai": "running", "eprecisio-com": "running"}}';
            add_header Content-Type application/json;
        }
    }
}